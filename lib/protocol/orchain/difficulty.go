package orchain
import (
    "bytes"
    "orwell/lib/butils"
    "math"
)

/*
    Target(x) = 2^((65536-x)/256)
    Table[IntegerString[IntegerPart[2^((65536 - x)/256)], 16, 64], {x, 0, 65536}]
*/

const BLOCKS_PER_DIFFICULTY_CHANGE = 32
const SECONDS_PER_BLOCK = 600

var precomputed_target0 =
    "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"  // actually the target is 2^256
var precomputed_targets = []string{
    "ff4ecb59511ec8a5301ba217ef18dd7c2f409857956d475fdb171474700cd72f", // 1
    "fe9e115c7b8f884badd25995e79d2f096934ec56be0d25443a7522ed803a527b", // 2
    "fdedd1b496a89f34c46757b38a53619a9a51534648d545d3d384492fd019d07f", // 3
    "fd3e0c0cf486c174853f3a5931e0ee03061b7bb285a607919d2285b6754edd61", // ...
    "fc8ec01121e447bb455d621825da76cdb403c10a9486a8e1c99326ff85e2a5dc",
    "fbdfed6ce5f09c489da5ff395ecae2e739407d2691a251fab0b01e0caee72247",
    "fb3193cc4227c3f46f66a72687c5c9a916932784d7f36d3fd3abb4c8f47e7d9f",
    "fa83b2db722a033a7c25bb14315d7fcc8006fe21a95d14dc4844b29bf4af18e8",
    "f9d64a46eb939f352d2e093e4110a050c1ff26607c2be13fe58dc6977e21c7cf",
    "f92959bb5dd4ba7434b7e1b1c86a6356aa3b5a8b17a070ecd4411193236aea98",
    "f87ce0e5b2094d9bbff35cfc575603f75eb627d2aa2a0b68186d077294be76da",
    "f7d0df730ad13bb8fe90d496d60fb6eae914ffb4723793f1ef6797b5a11efb7b",
    "f7255510c4288238d1b490ead1a26391b6a0efc487ad06bbc31e4ede33b3c6fc",
    "f67a416c733f846d81897dca4e77a310085da5e2673954806fa0747637fa34af",
    "f5cfa433e653729065e4527c9e33781dfed71a0bc8c1ae14fd19cf8db657d236",
    "f5257d152486cc2c7b9d0c7aed980fc36f510308677709f5bdd80329364aa29f",
    "f47bcbbe6db9fddeed6fe9f569e4c1ab9600edf2b860bbbbe9641242d47b3865",
    "f3d28fde3a641a5aa4594191bc33ac5427a4ab1aa31a520b66c8cf9333679fbe",
    "f329c9233b6bae9c0078add48cb237bf91b6b4e301c4f0bad6a032c6d6cb0f31",
    "f281773c59ffb139e8980a9cc8f47a4b2cf0b49df0bd70e97c43b0ea5d43228c",
    "f1d999d8b7708cc16b79c0472eac5c36c8cf63c1d8f1866f091b11738e8180fb",
    "f13230a7ad0945093b0fd0bd6d3233f3bfb9dfb2f0264af14e43a93ac4138172",
    "f08b3b58cbe8b76a56b2151c05e270c61394a0e54763a908ea498883dd311407",
    "efe4b99bdcdaf5cb46561cf6948db912d4a277eaddaa925c9392870834f21a53",
    "ef3eab20e032bc6b55ae30c8ae253e7f608ad7b82cb9abccb981016668f7efa0",
    "ee990f980da3025b4aef1e031851c990a94cf186a7db9a81e1a45d63e158fa35",
    "edf3e6b1d418a49121cdb28e8377be38770ccf69742460d58961b78f85eb6f01",
    "ed4f301ed9942b84600d2db6a64bfb123787630a764ae4c9c8e7c95b06416e6d",
    "ecaaeb8ffb03ab40a5b7735ed7c986e293249009e51591c1b023225083363b92",
    "ec0718b64c1cbddc27ce824402fc25f630a6f134c806efcc6941c6be3b14abda",
    "eb63b7431736983fd0f49502cb40362e03eb38ebfecd999882ddd5fd40b6e59b",
    "eac0c6e7dd24392ed02d75b3706e54fac4faace043b7f91c17d8d1e8ca31880a",
    "ea1e4756550eb27b6a77eb42c28a105e883d2b7b56aa42c86ddc8526c99011bd",
    "e97c38406c4f8c56f091cc4f51012da62b2a9fae6f72649239474f4549f01f39",
    "e8da9958464b42aac6c43346ddb3498c9cf719468d6a8e3fc6fa7a34975bb89d",
    "e8396a503c4bdc68791790d0ac70c7ddfe312f84fa6652043a1c6473409c261d",
    "e798aadadd5b9cbee2c8f240151d17803528b2412946cd7ce8e06c2a367b354c",
    "e6f85aaaee1fce227c4ac7d628df28afc62c5efdb7aba051d1c2a90c2f337539",
    "e658797368b3a716ef83cffb7b6bc0849cee7676637d793dccc8382cad2ba2b4",
    "e5b906e77c8348a81e5e8f4a4edbb0ecaacd6065b6e9f6accefcd5b62a14b818",
    "e51a02ba8e26d680d412ef2f70b028a4679928b0b4a683c50499a59924f40230",
    "e47b6ca0373da88d65e24402e2216edaac100b8f98cecf283b5476551468affa",
    "e3dd444c4649961894441daaaa6db8cf74f1496004c01243372c08fbb65f5a32",
    "e33f8972be8a5a5109bfe90795980eecf358a8d368fceaeafa8fcbb2e85b853e",
    "e2a23bc7d7d91225e0e49276b5e5d8d3913d60eaefdf3b8fd846ac13bf601477",
    "e2055afffe83d368a6fc1078c14529b37e9c3d3deeaa66fb9813fc9e153830b6",
    "e168e6cfd3295d235d3d06eb451d4a1e3902a3444b598fd82aa50492eeab8c09",
    "e0ccdeec2a94e111065895048dd333ca224b251b330920021cb99d3f1ff298a2",
    "e031430a0d99e6275a55e0435cbd20545e04172d541e333dbfae50cca0ceb661",
    "df9612deb8f0442046b8128c71a24fd039d9ab3b36fdab47f9efea86d3144a56",
    "defb4e1f9d1037f1ecee4f8ad256c9aa8e7b34f601edc7582a890af9f61f6e2b",
    "de60f4825e0e9123dd07a2d9e846685901438495eacdf256cc2490c8643ef6b3",
    "ddc705bcd378f7f056971b4b4efd6e4b6647fadf78095831df19a42e154e3cd7",
    "dd2d818508324c20659e357ada3f94b901babf0e63756e45d674b9dd39668eee",
    "dc9467913a4f1c91bd35669347454447b64c4919b96e89642e3e1644abf235df",
    "dbfbb797daf237553d840d5a9e29aa64481e1ab725b12d56613b0d1dbfa0d716",
    "db63714f8e2952551e6a5107edc5e87ba62a66189cb34828fa2794a77cd6d97c",
    "dacb946f2ac9cc71c40888b2439e38b8ff7e20820b5f053292884ac1244582b5",
    "da3420adba4d87044e10b1041b7ec1abfe30c0a911bc076481294087ddd445d2",
    "d99d15c278afd7b5fe873deca3e12babc0edda4d891be43db70cfbb1bdf6eb5d",
    "d9067364d44a929ba04940ead973be1284b6b9b1099e4eb5252027b258d689d6",
    "d870394c6db32c8421566fe37b65072ee571557ffd3d02aa65aca6a5debb9238",
    "d7da67311797f569a07e19d42669296953499797d86f74c834b3124d8abad638",
    "d744fccad69d6af439a68bb9902d3fde1d733af522058b16b5c13ada0e778299",
    "d6aff9d1e13ba2fde776d6371c9672d517686a3dd363846b1e96f2024a75f669",
    "d61b5dfe9f9bce06dcb3518932fe39f2403896907c2cbd473d53a1babe34ec11",
    "d5872909ab75d189c31dae94544ca1788de1e4d1d36952a32adce869f215e25f",
    "d4f35aabcfedfa1f5921deffa6262c5ab8e7a32e5783da5cfa628009459a2417",
    "d45ff29e0972c560f309a8bd4ae80f86ab35d0bafc33a2dee7d57f6733060d41",
    "d3ccf099859ac3796fd958ac78d4c3cb6744845742911b6549e9dc157c0138e1",
    "d33a5457a30290543d58c19c0d98dc34b7729023a85000617adbfca122f144b8",
    "d2a81d91f12ae45a12248e57c3de402852029c0b81f7be57fa7663033f05357a",
    "d2164c023056bcab0ff4ec09dbf148b0df13b73e63b387c15fae9597e9705649",
    "d184df6251699ac60b8fbb86d56aa3fd1161368b4753b16c2a3fddf914b87691",
    "d0f3d76c75c5db8cc31dd17ce1cdbf97db96bc602b1865be2eecce63e4ee285d",
    "d06333daef2b2594d6d45c6559a4d50211546d3ea28976d62a33269ab05c3e5d",
    "cfd2f4683f94eeb5631550e053253c39bf221e172e07a8be5851e14a6d23ea9b",
    "cf4318cf191918c12653c7326370087c960415dd6fd7b02e7e9c5d404ffa10be",
    "ceb3a0ca5dc6a55d282b844fb99d5cc8a28dc72d03636a008154102d450cb58e",
    "ce248c151f8480e3e235838f95f2c6ed6f28610b8c36485a2bbd398af35c079f",
    "cd95da6a9ff06444f63641255d03ecfc9fc30966165e2a91559b2cbd96e9ae2d",
    "cd078b86503dcdd1884dc62339bdf58cf0f56d3412e9e2aba13599b39ae862a3",
    "cc799f23d11510e55ed51263c7641a27a6f1079dc97882e00f6a557426ab3e2f",
    "cbec14fef2727c5cf4907c8f45ebf6dceb8a25b7b40c0426639aa6f940962625",
    "cb5eecd3b38597c8b4d301cc6ed4e2419f150089447800e249fe6fafc1ad76c9",
    "cad2265e4290774da41b4ad07e37be3eb0d959d11507559656b567cd9dd7811c",
    "ca45c15afcc72623c298682d266ad65f44abe07d2f92fd1479eaec998225ce0f",
    "c9b9bd866e2f27a280e1f92a0511697e257ac0db1f419377f4dd023ff93c7ffb",
    "c92e1a9d517f0ecbaa059c6248097ed955377d2f24fe6203cbc5bbf8b7371036",
    "c8a2d85c8ffe2c4530da34fb5b8700e1548114d262184f538c7a3b57450ae057",
    "c817f681416452b25950bfc7fa4cd5765305203d06c55ba8a9ef6c482d13d21b",
    "c78d74c8abb9b15cc13a2e3976c0277e4da570a2c574a304cea65224bc9900cf",
    "c70352f04336c51dd6b206c9a348e8b1571a3e51b8ba027cf6e9a9f97a453052",
    "c67990b5aa245f79550e68b0e2aec254c247c6229d9e5464a3112ee5f35eb5c1",
    "c5f02dd6b0bbc3d96bdf88688dcf2778da7a3f3026be2e09a6221a33bcf596f2",
    "c5672a115506dadd3e2ad0c964dd9f376b0f939998251a36c7686006e4e6c092",
    "c4de8523c2c07baa72a88ea405500138b6e3ff8601c66dfbebdfb7b2f0a9e4c0",
    "c4563ecc5334cb32985e6f96a74eb0941f79c2ef0b855907cb2d3c35b063a149",
    "c3ce56c98d21b15d2d7d2db47bcd0d30c7cc2adc1819e1cffff72c444615ad88",
    "c346ccda2497640720ec856128b83a426b9f89b7dabbcb2b5b718d616c4fef19",
    "c2bfa0bcfad907c8b16e0e9bd260d2c73739777483365d70215b86dc83fa512c",
    "c238d2311e3d667297b5cbe3204a9b87a8fa440bc8a6ebc33241b01f5d28cd36",
    "c1b260f5ca0fbb3373463be57aa794402ac14822ac9df77102c97ac239fd446e",
    "c12c4cca667094567c457d59a50087b56b2e5dd607a9969cdefefee72ae7a33d",
    "c0a6956e8836ca8c86e1a2a3a9ae34a6b2b0e93b41655c0e2a1eaf1d3d2a1859",
    "c0213aa1f0d08db06f33b24d1aa753835c726c5b8c53395fbe251f65d4fb19b1",
    "bf9c3c248e2486f80ee306cee52467c2cda16dffd65bf7120a57ef2e62d70cf6",
    "bf1799b67a731082e815d0abcbf0b850a13fc7e6faf9c83083ea957596be426d",
    "be935317fc378237bb7f6e57167312d0a4b5c839d7e8aade2be0ff026e9f8ada",
    "be0f6809860993e2499a22c9bab1596e499ea27e41477ea64e1094b49b8b075d",
    "bd8bd84bb67ed482894f72e46efb3f22ad3d0fe4cf33387b75a9c75f0efef910",
    "bd08a39f580c36bea8811fb66d0faf7a15b34bbcb0298f410d9a4be023ece031",
    "bc85c9c560e7b269350c555ba7bde9dec53608542be128e73bf37977c7a88450",
    "bc034a7ef2e9fb0cd7014042c595d95ee7c3668471afd826077519b329d97ffe",
    "bb81258d5b704b6f0ee2d228feff0a31d170c27364f738520ed8bcea8807a232",
    "baff5ab2133e45fb74d519d24593838c02f30d0bdcaa516d6c373a75c2828202",
    "ba7de9aebe5fea08ffac314dc38da1019fd6dc823637c028eef844bc17087284",
    "b9fcd2452c0b9deae4d27345588c15710bf9d3b40bacaa9f421b6e9dd2069976",
    "b97c143756844dbeabfa653a71b9dc81207d141e465ec40e69b04a574697453f",
    "b8fbaf4762fb9ee91b879778566b65a1a5ab16cf451056ed322d7893ed4da9a7",
    "b87ba337a1743833ac89a8b54cbd898d5dc2e1757da4aed1eb18fee2d5aa212a",
    "b7fbefca8ca41e7c3f0da79f109dffcdb816ad523be09291e6f74c02be13a15c",
    "b77c94c2c9d725e8d16c3ca6e9bcae4986baa5ce0d6bbe519584de6892d9e62a",
    "b6fd91e328d1779107165f0ddd541a59f88abbe777df360e20850e774a86cd8e",
    "b67ee6eea3b22b8f5536de2e611e77f34d8168261d0bf03957f657632733455b",
    "b60093a85ed5f76bb54cc007a799fef5c58766c188837abd9e7f3835ec4f09d4",
    "b58297d3a8b9f0d1c7a964d4e87196bba59626d17c175f4a260997fa3cdefde9",
    "b504f333f9de6484597d89b3754abe9f1d6f60ba893ba84ced17ac8583339915",
    "b487a58cf4a9c1804bd9aeb445c9c1c54dd0c515606a75908ea3c7f987b8ad30",
    "b40aaea2654b9840e2b913dcf993835ff27313ec04d42ee6331e43feeba19bc8",
    "b38e0e38419fae178cda7939ecc7d67a035136892be7d0e49deff07cac7abc3c",
    "b311c412a91124893ecf14dc798a519bfa6e051d6f8bc3ffba1e54cf684354de",
    "b295cff5e47db4a38546cb183ee9fed345439e0d3ab064b9e7d558333ba952ec",
    "b21a31a66618fe3b7c38a6276cd2720800183881d0c67bd3703d9652f904af16",
    "b19ee8e8c94feb08e217d72c9cab9710a885eedafb0b39b6e2daa4c2b508517a",
    "b123f581d2ac258f87d037e96d215d8e757cfb9913adc57797ced890d5b0b0c0",
    "b0a957366fb7a3c967c9570984dea5c359bcda53816aeaa25ba114bd5ce64962",
    "b02f0dcbb6e04583b7ac9524371d9a7568da3b4efc33dce44e6795b3bd18d873",
    "afb51906e75b86615221c32306e43869bef1dd1e20e5e8089bedd9fda4de45c3",
    "af3b78ad690a4374df26101ccbb35032a4502c14f429ded95a8c73beaa946990",
    "aec22c84cc5c94652b0ae97537a936e7f668dbfd7ab23ff46cf2163e34eca7e5",
    "ae493452ca35b80e258dc0b4c35101ec2735254978bcf38c444535708f2a61a7",
    "add08fdd43d014910bd67b983cca3b6fd8c420ffe3a7712a12917d46c64d87d4",
    "ad583eea42a14ac64980a8c8f59a2ec46be409407034fdedb165f141833a67da",
    "ace0413ff83e5d03a62373033e27431dcbc6ef094ee95463dc124001ce3662de",
    "ac6896a4be3fe9295e15b9a1de797649b54b86ce6133780397aa0927eadcd0c9",
    "abf13edf162675e8ce6eb508c771633b70582aeff5753fa1c72488926bdf3f7e",
    "ab7a39b5a93ed337658023b2759e00797ad59ec00ebe6393967357d6b36df9f7",
    "ab0386ef48868de0923d2e22820c8894d72bae38b2beec5834d68c519b8b21f3",
    "aa8d2652ec90762976310121a65339322ee360926b30cd43ab9ca6a23021f24b",
    "aa1717a7b569397926d192d5f7dddb30fa2bf28ac78dbd5c738dd0f03fc6c1f1",
    "a9a15ab4ea7c0ef8541e24ec3531fa733951f214c02d824a325c9e2203504516",
    "a92bef41fa77771b3395e0808475ed16bd3145c2f07cfc12728a7809a8adfeb1",
    "a8b6d5167b320e0897a96426c110c8738c1130bbebb0469001c44dd0877422e2",
    "a8420bfa298f70d124da4dba32f60bd92a0f5ee081ef78d2f1c2ae09e911b319",
    "a7cd93b4e96535699ec5b4d5039f72af01424bd194d3999edd30939a1d1e929b",
    "a7596c0ec55ff55b505a3450b5b8623c697b89379fbd18b21cf0915547f19504",
    "a6e594cfeee86b1d9b778d4f066242592d2ab3685eafac5691ac2c1608ae9a3d",
    "a6720dc0be08a20bc52d2157ab991a22f79e21e63d6fefe77175983715150821",
    "a5fed6a9b15138ea1cbd7f621710701b1dd170ace2bcfc172589c98a8290d3f0",
    "a58bef536dbeb6eda4780d76810304880d423dc590f83e0c683e1037dc441285",
    "a5195786be9ef3396c5e7a37cac3230ed8ec3c58e8a45e9e65cf7c5509ce7747",
    "a4a70f0c95768ec4d76a1b661607d7016ec8dca99f3946783b045f6ba5b87e6d",
    "a43515ae09e6809e0d1db4831781e1eebae743abfbc073764c72418596cc5bd0",
    "a3c36b345991b47be1e25775199c692a0bb8589efd88b6a3f7721ffa30e2f938",
    "a3520f68e802bb92897a2c914ecbefa027f90f9ce0daca69d3e6b8b2adc07dc2",
    "a2e102153e918f9e6f99f41381c73d2e30dd2d29bc9da6c2b1b5240d52b97952",
    "a27043030c4968189b7a04ef80cfdea79da4384dbc2c8eae5a7a799221808de9",
    "a1ffd1fc25cea1880be9704c0029ada64d6da9c85e765bf74b68fc604ac4b66f",
    "a18faeca8544b6e38221ca08667640f1258657fbac0f7a093fb8c9474c218754",
    "a11fd9384a344cf73a47e99d64571a93438000c03f9c82c3e0af8d33d65d78b0",
    "a0b0510fb9714fc2192dc79edb0fd9a9782a0735d02b1a209f33f7bc78dc629e",
    "a041161b3d0121bddf8b6f4d0484a2c71d512573d2c0b383f3ab2e973c82b59e",
    "9fd228256400dd05fb80d520c197dc60e46deff9624c84f36307e33cc7a2309a",
    "9f6386f8e28ba65099c84736435e643210cb645d9d210942491179993ecdc074",
    "9ef5326091a111ada0911f09ebb9fdd165c15c122133e2a221f977fe7c7fa117",
    "9e872a276f0b98ff46846142638811ba164ea659150644d825c3dc1053b988e1",
    "9e196e189d47242000f9145ac79bbaf0355b31a9800fd74fe4f675e726c504fb",
    "9dabfdff6367a2a98cdc4dffe30eb47c5971df4007e0b679cc6d1778fce071f1",
    "9d3ed9a72cffb750de494cf050e99b0b1ff17c29677589a033a6fe2d4fd53e8a",
    "9cd200db8a0774cacb406e3ad9773803a8b77a42ffa0b3b6b82815d4c41fd279",
    "9c6573682ec32c2d4e586cdf686429de985013c8498f5974782aa228955ad395",
    "9bf93118f3aa4cc146ac2629b88157469ed7e12f8654bdf486de301980f02408",
    "9b8d39b9d54e5538a2a817a2a3cc3f1f0928b5fce34cdf219769d9b0a908a786",
    "9b218d16f441d63cebb5f9347a27e2ec1048e02592b4bdcdba06bc09e278186c",
    "9ab62afc94ff864a311a3b1b9d79c6b6c6b7ca8364dde49e5df99d25efae3562",
    "9a4b13371fd166ca58a6cf77e5beb8a50958493369f3e46de72c22128913a01a",
    "99e0459320b7fa64e43086cb34b5fcae8ac981ca9ceca6b31560e51a5df911db",
    "9975c1dd47518c7742f869619cf2439c62fbb3a378f8365a2f04a8f5fedf59cf",
    "990b87e266c189a9ce78e18047c36ef1910570bd002db2095f0a11d62811a00d",
    "98a1976f7597e9959a3f3f3fcd09b8c53e391f92a01895668d131bbf258f4d3a",
    "9837f0518db8a96f46ad23182e42f6f65e139a1b14fa8178d78b65cbefa7bb6f",
    "97ce9255ec4357ab0eaab35095b5286089c7420987fa18ad90b34a2e8a33d751",
    "97657d49f17ab08e507a2ea91c19d7b08dee6d129e2aa6793bfedaba5b2c8fb3",
    "96fcb0fb20ac4ba2d9ff779c3306ab719e973de00e5d76598e22e7ca81145061",
    "96942d3720185a0048ea9b683a9c22c4e0e68d9f200c53589a22b1526bb6a2e3",
    "962bf1cbb8d9755fd74b2295db70edd1ded1a015eda82d55b2e77b68edd9f2ca",
    "95c3fe86d6cc7feef52329c7e55c42217ee1e5b6f228c8b2f6b254b2e38f9d85",
    "955c5336887894d5179cdd2deb188864a06312028b9617107345ab054feea77d",
    "94f4efa8fef709612e8afad12551de544856046901ff6c05035fb634c2e63a0e",
    "948dd3ac8ddb7ed338dd7bfe34302f47205a8dc988bc6c9a098504e3b3e02fda",
    "9426ff0fab1c04b678ae781e504b3fed517296be4083797131667d86cb2bf713",
    "93c071a0eef94bc0cf80bf3ced7215a4188dd63ab07bb2b77eeb396989b39eec",
    "935a2b2f13e6e92bd339940e9d924ee72748c36eeaffa273583eab6852a22bb1",
    "92f42b88f673aa7c34495863658add373b0445e68cb88510168028812438a80b",
    "928e727d9531f9ac155bef4f4a408d4e457ee7bcb49a5e329694f4b302bcc1d2",
    "9228ffdc10a051acfcc911ca996308c76a278e000df4de9af8c4192d32df715e",
    "91c3d373ab11c3360fd6d8e0ae5ac9d81942b34816fb4f26f1203caf65bfb9b9",
    "915eed13c89689d34fb5577d69ec8f1bd5af79f10827f1ee34c07743b2f14863",
    "90fa4c8beee4b12a97e9494a5eda5b0f53123be550ee7411dce4f1e36b3218bd",
    "9095f1abc540ca6b25a59f95591d33697fbec6eac2c19a8e05ee9bf0633f5b01",
    "9031dc431466b1dc775814a8494e87e243e90e15c20021326f398dfe3f7903f1",
    "8fce0c21c67264815b6bed0a147a1e4a201f3e790b1a59a9b4fe232de9ca34c9",
    "8f6a8117e6c8e5c40cffb0890e8f28269b623a3a64dbef30334da2535f18a079",
    "8f073af5a201352044feee692437dd303f4cbc7d01daf8e7b74e08e5176d96b8",
    "8ea4398b45cd53c02dc0144c8783d4c5a11037230b367828eb90ce3700bf59b6",
    "8e417ca940e35a012ef0021f191cf148efc6d6331c76638e4a2769e6460c5dcf",
    "8ddf042022e69cd58f395a213f1afcd65abf239c8aa8cd0da245d30141bd4e8b",
    "8d7ccfc09c50e2f7f0b496d24ffd47a77b881085f61b80904178c7eafb4241db",
    "8d1adf5b7e5ba9e5b4c7b4968e41ad36183926ae7d718dc2724a166325437476",
    "8cb932c1bae97a955bb0be2fc1058a59e28c28e639a74b46674f3ef503000305",
    "8c57c9c4646f4dddfb85cd1e1282e4be008172f8908ca0e942044b89100c240e",
    "8bf6a434adde0084f1ff1562d3210f94cec9c92104b49bd22985be8920170a48",
    "8b95c1e3ea8bd6e6fbe4628758a53c901aa84ffbebac349f91e135ee84a3f733",
    "8b3522a38e1e1031e47705d43464e7637b2fcfa3fef55885ce8f6b76d0efe609",
    "8ad4c6452c72892406ab9eeab09dfc9515b0c7718d9bb61344944a5e9cea095f",
    "8a74ac9a79896e46e17c640bb54a08804a5b2373989a7e61474378a3fe169a13",
    "8a14d575496efd9a080ca1d92c3680c2259c4df53d76e910e9c32d22e935007d",
    "89b540a7902557a3bdc116dc8c41c9a4e34e91caa118787bf27033b935634b05",
    "8955ee03618e5fdc95d69926b4717b9385efbe76fca758e5c0c1d68ca080770f",
    "88f6dd5af155ac6b75611f8091c09a2a590d812c3c7e931bd6d12494c59a4a44",
    "88980e8092da85275df8d76c98c67562e623d58b3772ba138bc3587fb118c94d",
    "88398146b919f1d46eb1692fdd53eae02b690eb4fa95f53a78645397236896d0",
    "87db357ff698d7919048eec50a1328a705b13ded34a52005134c0ea940d82c7a",
    "877d2afefd4e256c48c8757fbc915a95477e0701fd8b85766b616e170545ae25",
    "871f61969e8d10103a1727c57b52a956259ac58894f4fcb35229a7352c9b247a",
    "86c1d919caef5c87d6437819d2bd2d2827da38ec7064316ff5214123e1dc4bea",
    "8664915b923fba03db82dc49ee2f45562b2737f1778ea18fecabf494095a57a4",
    "86078a2f23642a9f3120da439de139d71c412378df14934591b270bc492fe9e0",
    "85aac367cc487b14c5c95b8c2154c1b2148a0459e75851515d42b362af1ee859",
    "854e3cd8f9c8c95d16c873d1d378c1c9a23f7708cf218f12dbdfa04f28c0d353",
    "84f1f656379c1a290f03062c26b5ba5d17011ed39873fe65bab5e16c50dfceb9",
    "8495efb3303efd2ff38ffeb805e14189ff8d63ef80157021f8e7028f144f0fd1",
    "843a28c3acde40461af92eca13fd15820d96b414ec4c9d06806bddad09d9c4a3",
    "83dea15b9541b132334544586ffe6d472af66c991b2a1028ce8dd8666bb1afd2",
    "8383594eefb6ee36e201d4ec3d93f683e5c5849563af188ba9635773515ea75d",
    "83285071e0fc454690950cc78d29f056ff36264c3caa8a431f3022a9ea01f849",
    "82cd8698ac2ba1d73e2a475b46520bff29f1a4afbefa5d7c2502f15067378a17",
    "8272fb97b2a5894c3793aa0d08c818fb352354079f8705c13238bcc83c11c14a",
    "8218af4373fc25eb9c7cd106d23f3768205da5fe02d7b22af4dd226b00abd888",
    "81bea1708dde6055a047bab784691313d5abd77e8e1d3a0208c5286417cced25",
    "8164d1f3bc0307737be56527bd14def49eb851655e2e5c4dd08075ac1f200e4c",
    "810b40a1d81406d40cef03ab14a6654fa9c9ffc2ca67ffdeada5b6f36036c859",
    "80b1ed4fd999ab6c25335719b6e6fd2001f60261b05f120203c355acba4df4f9",
    "8058d7d2d5e5f6b094d589f608ee4aa22adc0c3f864ba0f59dc70119154b8f9a", // 255
    "8000000000000000000000000000000000000000000000000000000000000000", // 256
}

func DifficultyToTarget(difficulty uint16) (i butils.Uint256) {
    if difficulty == 0 {
        i, _ = butils.FromHex(precomputed_target0)
        return
    }
    var s uint8 = uint8(difficulty / 256)
    var t uint8 = uint8(difficulty % 256)
    if t == 0 {
        i, _ = butils.FromHex(precomputed_targets[255]) // 255 == -1, done just for clarity
        i.ShiftR(s-1)
    } else {
        i, _ = butils.FromHex(precomputed_targets[t-1])
        i.ShiftR(s)
    }
    return
}

func DifficultyToWork(difficulty uint16) (i butils.Uint256) {
    return DifficultyToTarget(65535 - difficulty)
}

// The hash value must be lower than or equal to the target.
func HashMeetsTarget(hash, target butils.Uint256) bool {
    return bytes.Compare(hash[:], target[:]) <= 0
}

func HashMeetsDifficulty(h butils.Uint256, d uint16) bool {
    return HashMeetsTarget(h, DifficultyToTarget(d))
}

// Calculates how should the difficulty change after a given time interval
//
// The difficulty should be recalculated for each block number divisible by 1024 (0, 1024, 2048, 3072, etc).
//
// When creating a block with updated difficulty, the time_delta to be used should be equal to the timestamp
// of the block (currently being created) minus the timestamp 1024 blocks ago.
func DifficultyDeltaForTimeDifference(time_delta uint64) int16 {

    var seconds_expected = BLOCKS_PER_DIFFICULTY_CHANGE * SECONDS_PER_BLOCK
    var seconds_elapsed = time_delta

    var ratio float64
    if seconds_elapsed == 0 {
        ratio = 2
    } else {
        ratio = float64(seconds_expected) / float64(seconds_elapsed)
        if ratio < 0.5 { ratio = 0.5 }
        if ratio > 2 { ratio = 2 }
    }

    result := 256 * math.Log2(ratio)

    return int16(math.Floor(result))
}

func ApplyDifficultyDelta(difficulty uint16, delta int16) uint16 {
    if delta >= 0 {
        abs := uint16(delta)
        if abs < 65535 - difficulty {
            return difficulty + abs
        } else {
            return 65535
        }
    } else {
        abs := uint16(-delta)
        if difficulty > abs {
            return difficulty - abs
        } else {
            return 0
        }
    }
}